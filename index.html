<!DOCTYPE html>
<html>
<head>
   <title>Artwork Rating Study</title>
   <!-- Core jsPsych -->
   <script src="https://unpkg.com/jspsych@7.3.3"></script>
   <!-- jsPsych plugins -->
   <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.2"></script>
   <script src="https://unpkg.com/@jspsych/plugin-survey-html-form@1.0.2"></script>
   <!-- jsPsych stylesheet -->
   <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css"/>
   <!-- Font Awesome for arrow icon -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
   <!-- Font Poppins -->
   <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
   <style>
        * {
            font-family: 'Poppins', sans-serif;
        }
        /* Add these new banner styles first */
        .banner {
            width: 100%;
            background-color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
            box-sizing: border-box;
        }

        .banner img {
            max-width: 400px;
            width: 90%;
            height: auto;
            display: block;
            margin: 0 auto;
        }

        /* Media queries for different screen sizes */
        @media screen and (max-width: 768px) {
            .banner {
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .banner img {
                max-width: 350px;
            }
        }

        @media screen and (max-width: 480px) {
            .banner {
                padding: 10px;
                margin-bottom: 15px;
            }
            
            .banner img {
                max-width: 300px;
            }
        }

       .artwork-container {
           max-width: 100%;
           margin: 0 auto;
           padding: 20px;
           font-family: "Open Sans", "Arial", sans-serif;
       }
       .question-text {
           font-weight: bold;
           font-size: 1.25em;
           margin-bottom: 20px;
       }
       .instructions {
           text-align: left;
           max-width: 800px;
           margin: 0 auto;
       }
       .instructions h2 {
           text-align: center;
           margin-bottom: 30px;
       }
       .artwork-image {
           width: 400px;
           height: 300px;
           object-fit: contain;
           margin: 20px auto;
           display: block;
           border: 2px solid black;
           padding: 10px;
           background-color: white;
           margin-left: auto;
           margin-right: auto;
       }
       textarea {
           width: 100%;
           height: 100px;
           margin: 20px 0;
           padding: 15px;
           font-size: 16px;
           border: 1px solid #ccc;
           border-radius: 4px;
           resize: vertical;
           font-family: inherit;
       }
       .continue-btn {
           background-color: #007AC0;
           color: white;
           padding: 10px 20px;
           border: none;
           border-radius: 4px;
           cursor: pointer;
           font-size: 16px;
           display: inline-flex;
           align-items: center;
           gap: 10px;
           font-family: 'Poppins', sans-serif;
       }
       .continue-btn:hover {
           background-color: #006AA6;
       }
       .form-group {
           margin-bottom: 20px;
       }
       .form-input {
           width: 100%;
           max-width: 200px;
           padding: 8px;
           margin: 5px 0;
           border: 1px solid #ccc;
           border-radius: 4px;
           font-size: 16px;
       }
       .radio-group {
           display: flex;
           flex-direction: column;
           gap: 10px;
           margin-top: 10px;
       }
       .radio-option {
           display: flex;
           align-items: center;
           gap: 10px;
       }
       .radio-option input[type="radio"] {
           margin: 0;
       }
       .radio-option label {
           margin: 0;
           font-size: 16px;
       }
       .consent-options {
           display: flex;
           justify-content: center;
           gap: 20px;
           margin-top: 30px;
       }
       .prolific-id-input {
           width: 100%;
           max-width: 300px;
           padding: 10px;
           margin: 10px 0;
           border: 1px solid #ccc;
           border-radius: 4px;
           font-size: 16px;
       }
       @media (max-width: 768px) {
           .artwork-container {
               padding: 10px;
           }
           .artwork-image {
               width: 90%;
               height: auto;
               max-width: 400px;
           }
       }
       /* Remove the default jsPsych button */
       .jspsych-btn {
           display: none !important;
       }
   </style>
</head>
<body>
   <script>
   // Initialize jsPsych
   const jsPsych = initJsPsych({
       use_webaudio: false,
       on_finish: function() {
           const csv = jsPsych.data.get().csv();
           const blob = new Blob([csv], { type: 'text/csv' });
           const url = window.URL.createObjectURL(blob);
           const a = document.createElement('a');
           a.href = url;
           a.download = 'artwork_ratings_data.csv';
           a.click();
       }
   });


   // Define your stimuli
   const stimuli = [
       { id: 1, image: 'images/artwork1.jpg' },
       { id: 2, image: 'images/artwork2.jpg' },
       { id: 3, image: 'images/artwork3.jpg' },
       { id: 4, image: 'images/artwork4.jpg' },
       { id: 5, image: 'images/artwork5.jpg' },
       { id: 6, image: 'images/artwork6.jpg' }
   ];
   
   // NEW Add the color stimuli here
   const colorStimuli = [
       { id: 1, combination: 'Blue and Yellow' },
       { id: 2, combination: 'Green and Orange' },
       { id: 3, combination: 'Black and Red' },
       { id: 4, combination: 'Brown and Pink' },
       { id: 5, combination: 'Blue and Green' },
       { id: 6, combination: 'Yellow and Purple' }
   ];
   // Define shape stimuli
   //const shapeStimuli = [
       //{ id: 1, shape: 'A Circle' },
       //{ id: 2, shape: 'A Triangle' },
       //{ id: 3, shape: 'A Rectangle' },
       //{ id: 4, shape: 'A Square' },
       //{ id: 5, shape: 'An Oval' },
       //{ id: 6, shape: 'A Line' }
   //];

   const shapeStimuli = [
       { id: 1, image: 'images/circle.jpg' },
       { id: 2, image: 'images/triangle.jpg' },
       { id: 3, image: 'images/rectangle.jpg' },
       { id: 4, image: 'images/octagon.jpg' },
       { id: 5, image: 'images/oval.jpg' },
       { id: 6, image: 'images/line.jpg' }
   ];

   // Prolific ID input
   const prolificId = {
       type: jsPsychSurveyHtmlForm,
       html: `
           <div class="banner">
               <img src="MITLogo.jpg" alt="MIT Sloan School of Management">
           </div>
           <div class="instructions">
               <h2>Please enter your unique <strong>Prolific ID</strong>:</h2>
               <input type="text" name="prolific_id" class="prolific-id-input" required>
               <button type="submit" class="continue-btn">
                   Continue <i class="fas fa-arrow-right"></i>
               </button>
           </div>
       `,
       data: {
           task: 'prolific_id'
       }
   };


   // Welcome screen with study requirements
   const welcomeScreen = {
       type: jsPsychHtmlButtonResponse,
       stimulus: `
           <div class="banner">
               <img src="MITLogo.jpg" alt="MIT Sloan School of Management">
           </div>
           <div class="instructions">
               <h2><strong>A warm welcome to our research study!</strong></h2>
               <p>Thank you for considering our study.</p>
               <p>In this study it is crucial that your are able to focus for about 30 minutes.</p>
               <ul style="text-align: left; list-style-type: disc; margin-left: 30px;">
               <li style="margin-bottom: 10px;">Please only proceed if you can allocate your full attention for the duration of the study.</li>
               <li style="margin-bottom: 10px;">Please close all other tabs in your browser (other than Prolific's) before you begin.</li>
               <li style="margin-bottom: 10px;">Please avoid distractions from your phone/ email, so you can focus on this study.</li></ul>
               <p>Thank you for understanding and we hope you will enjoy it!</p>
           </div>
       `,
       choices: ['Continue'],
       button_html: '<button class="continue-btn">%choice% <i class="fas fa-arrow-right"></i></button>'
   };


   // Consent information page 1
   const consentInfo1 = {
       type: jsPsychHtmlButtonResponse,
       stimulus: `
           <div class="banner">
               <img src="MITLogo.jpg" alt="MIT Sloan School of Management">
           </div>
           <div class="instructions">
               <h2><strong>We need your consent to proceed - Information Sheet for Participants (Behavioural) (1/2)</strong></h2>
              
               <p><strong>Title of Study:</strong> Decision-making (Behavioural)</p>
              
               <p><strong>(Consent Form 1/2)</strong></p>
              
               <p>Click to continue to read the Information Sheet</p>
           </div>
       `,
       choices: ['Continue'],
       button_html: '<button class="continue-btn">%choice% <i class="fas fa-arrow-right"></i></button>'
   };


   // Consent information page 2 with options
   const consentInfo2 = {
       type: jsPsychHtmlButtonResponse,
       stimulus: `
           <div class="banner">
               <img src="MITLogo.jpg" alt="MIT Sloan School of Management">
           </div>
           <div class="instructions">
               <h2>We need your consent to proceed - Information Sheet for Participants (Behavioural) (2/2)</h2>
              
               <p>You should read the information below, and ask questions about anything you do not understand before deciding whether or not to participate.</p>
           </div>
       `,
       choices: ['I agree to participate', 'No thanks. I do not want to participate'],
       button_html: [
           '<button class="continue-btn">%choice% <i class="fas fa-arrow-right"></i></button>',
           '<button class="continue-btn">%choice%</button>'
       ],
       on_finish: function(data) {
           if (data.response === 1) {
               // If participant doesn't consent, end the experiment
               jsPsych.endExperiment('Thank you for your interest. The experiment has ended.');
           }
       }
   };


   // Task instructions
   const taskInstructions = {
       type: jsPsychHtmlButtonResponse,
       stimulus: `
           <div class="banner">
               <img src="MITLogo.jpg" alt="MIT Sloan School of Management">
           </div>
           <div class="instructions">
               <h2>Your first task - please read the following instructions carefully:</h2>
               <p>Now we are interested in your opinion on different <strong>artworks</strong>.
               Imagine you are giving your opinion <strong>as part of a conversation</strong>.</p>
               <p>For <strong>some of the artworks you will be shown the opinion of someone else
               and you will see whether they liked them or not.</strong></p>
               <p>We encourage you to take your time with each image. In order for us to check
               your attention during the task, you will be asked questions about some of the images.
               Note that participants, who do not read and follow instructions sincerely,
               will not be compensated.</p>
           </div>
       `,
       choices: ['<i class="fas fa-arrow-right"></i>'],
       button_html: '<button class="continue-btn">%choice%</button>'
   };

    // NEW Add these new constants
    const transitionScreen = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `
            <div class="banner">
                <img src="MITLogo.jpg" alt="MIT Sloan School of Management">
            </div>
            <div class="instructions">
                <h2>Well done! You have completed the first task. Now you will move on to the next!</h2>
            </div>
        `,
        choices: ['Continue'],
        button_html: '<button class="continue-btn">%choice% <i class="fas fa-arrow-right"></i></button>'
    };

    const colorTaskInstructions = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `
            <div class="banner">
                <img src="MITLogo.jpg" alt="MIT Sloan School of Management">
            </div>
            <div class="instructions">
                <h2>Your second task - please read the following instructions carefully:</h2>
                <p>Now we are interested in your opinion on different <strong>colour combinations</strong>. 
                Again, imagine you are giving your opinion as part of a conversation.</p>
                <p><strong>For some of the colour combinations you will be shown the opinion of someone else 
                and you will see whether they liked them or not.</strong></p>
                <p>We encourage you to take your time with each colour combination. In order for us to check 
                your attention during the task, you will be asked questions throughout. Note that participants, 
                who do not read and follow instructions sincerely, will not be compensated.</p>
                <p>Let's go!</p>
            </div>
        `,
        choices: ['Continue'],
        button_html: '<button class="continue-btn">%choice% <i class="fas fa-arrow-right"></i></button>'
    };
    // Transition to shape task
   const shapeTransitionScreen = {
       type: jsPsychHtmlButtonResponse,
       stimulus: `
           <div class="banner">
               <img src="MITLogo.jpg" alt="MIT Sloan School of Management">
           </div>
           <div class="instructions">
               <h2>Nice work! You have completed your second task. Now you will move on to the final task!</h2>
           </div>
       `,
       choices: ['Continue'],
       button_html: '<button class="continue-btn">%choice% <i class="fas fa-arrow-right"></i></button>'
   };
   // Shape task instructions
   const shapeTaskInstructions = {
       type: jsPsychHtmlButtonResponse,
       stimulus: `
           <div class="banner">
               <img src="MITLogo.jpg" alt="MIT Sloan School of Management">
           </div>
           <div class="instructions">
               <h2>Here is your final task - please read the following instructions carefully:</h2>
               <p>Now we are interested in your opinion on different <strong>kind of shapes</strong>. 
               Again, imagine you are giving your opinion as part of a conversation.</p>
               <p><strong>For some of the shapes you will be shown the opinion of someone else 
               and you will see whether they liked them or not.</strong></p>
               <p>We encourage you to think about each shape. Again, in order for us to check 
               your attention during the task, you will be asked questions throughout. Note that participants, 
               who do not read and follow instructions sincerely, will not be compensated.</p>
               <p>Almost done!</p>
           </div>
       `,
       choices: ['Continue'],
       button_html: '<button class="continue-btn">%choice% <i class="fas fa-arrow-right"></i></button>'
   };

    // NEW - Replace your existing createBalancedDesign function with this one
    function createBalancedDesign(stimuliArray = stimuli) {
        const shuffledStimuli = jsPsych.randomization.shuffle([...stimuliArray]);
        return {
            A: shuffledStimuli.slice(0, 2),
            B: shuffledStimuli.slice(2, 4),
            C: shuffledStimuli.slice(4, 6)
        };
    }

   // Function to count words
   function countWords(text) {
       return text.trim().split(/\s+/).filter(word => word.length > 0).length;
   }


   // Function to check response and handle validation
   function checkResponse(button) {
       const form = button.closest('form');
       const response = form.querySelector('textarea[name="response"]').value;
       const wordCount = countWords(response);


       if (wordCount < 30) {
           alert("Your response must be at least 30 words long. Please add more detail to your response.");
           return false;
       }


       // If validation passes, submit the form programmatically
       form.dispatchEvent(new Event('submit', { cancelable: true }));
   }


   // Function to create a trial
   function createTrial(stimulus, condition) {
       let questionText;
       switch(condition) {
           case 'A':
               questionText = "I like the following artwork a lot. What is your opinion of it?";
               break;
           case 'B':
               questionText = "I do not like the following artwork at all. What is your opinion of it?";
               break;
           case 'C':
               questionText = "What is your opinion of the following artwork?";
               break;
       }


       return {
           type: jsPsychSurveyHtmlForm,
           html: `
               <div class="banner">
                   <img src="MITLogo.jpg" alt="MIT Sloan School of Management">
               </div>
               <div class="artwork-container">
                   <div class="question-text">${questionText}</div>
                   <img src="${stimulus.image}" class="artwork-image" alt="Artwork">
                   <textarea id="response" name="response"
                       placeholder="Please write your brief answer here (30-100 words):"></textarea>
                   <button type="button" class="continue-btn" onclick="checkResponse(this)">
                       Continue <i class="fas fa-arrow-right"></i>
                   </button>
               </div>
           `,
           data: {
               stimulus_id: stimulus.id,
               condition: condition,
               image: stimulus.image
           },
           on_load: function() {
               document.querySelector('form').onsubmit = function(e) {
                   e.preventDefault();
                   return false;
               };
           }
       };
   }
   // Helper function to get CSS color values
   function getColorValue(colorName) {
       // Map color names to CSS color values
       const colorMap = {
           'Blue': '#0000FF',
           'Yellow': '#FFD700', // Using a slightly darker yellow for better visibility
           'Green': '#008000',
           'Orange': '#FFA500',
           'Black': '#050003',
           'Red': '#FF0000',
           'Brown': '#8B4513',
           'Pink': '#FC47A2',
           'Purple': '#4C0082'
       };
       return colorMap[colorName] || colorName;
   }

   // NEW Add this new function after createTrial
   function createColorTrial(stimulus, condition) {
       let questionText;
       switch(condition) {
           case 'A':
               questionText = "I like the following colour combination a lot. What is your opinion of it? Here it is:";
               break;
           case 'B':
               questionText = "I do not like the following colour combination at all. What is your opinion of it? Here it is:";
               break;
           case 'C':
               questionText = "What is your opinion of the following colour combination? Here it is:";
               break;
       }

       // Split the color combination into individual colors
       const colors = stimulus.combination.split(' and ');
       
       // Create colored spans for each color
       const coloredText = `
           <span style="color: ${getColorValue(colors[0])}; font-weight: bold;">${colors[0]}</span>
           and
           <span style="color: ${getColorValue(colors[1])}; font-weight: bold;">${colors[1]}</span>
       `;

       return {
           type: jsPsychSurveyHtmlForm,
           html: `
               <div class="banner">
                   <img src="MITLogo.jpg" alt="MIT Sloan School of Management">
               </div>
               <div class="artwork-container">
                   <div class="question-text">${questionText}</div>
                   <div style="font-size: 24px; margin: 40px 0; text-align: center; background-color: #f5f5f5; padding: 20px; border-radius: 8px;">
                       ${coloredText}
                   </div>
                   <textarea id="response" name="response" 
                       placeholder="Please write your brief answer here (30-100 words):"></textarea>
                   <button type="button" class="continue-btn" onclick="checkResponse(this)">
                       Continue <i class="fas fa-arrow-right"></i>
                   </button>
               </div>
           `,
           data: {
               stimulus_id: stimulus.id,
               condition: condition,
               combination: stimulus.combination,
               task: 'color_combinations'
           },
           on_load: function() {
               document.querySelector('form').onsubmit = function(e) {
                   e.preventDefault();
                   return false;
               };
           }
       };
   }

    // Create shape trial function
   function createShapeTrial(stimulus, condition) {
       let questionText;
       switch(condition) {
           case 'A':
               questionText = "I like the following kind of shape a lot. What is your opinion of it? Here it is:";
               break;
           case 'B':
               questionText = "I do not like the following kind of shape at all. What is your opinion of it? Here it is:";
               break;
           case 'C':
               questionText = "What is your opinion of the following kind of shape? Here it is:";
               break;
       }

       return {
           type: jsPsychSurveyHtmlForm,
           html: `
               <div class="banner">
                   <img src="MITLogo.jpg" alt="MIT Sloan School of Management">
               </div>
               <div class="artwork-container">
                   <div class="question-text">${questionText}</div>
                   <img src="${stimulus.image}" class="artwork-image" alt="Shape">
                   <textarea id="response" name="response" 
                       placeholder="Please write your brief answer here (30-100 words):"></textarea>
                   <button type="button" class="continue-btn" onclick="checkResponse(this)">
                       Continue <i class="fas fa-arrow-right"></i>
                   </button>
               </div>
           `,
           data: {
               stimulus_id: stimulus.id,
               condition: condition,
               image: stimulus.image,
               task: 'shape_task'
           },
           on_load: function() {
               document.querySelector('form').onsubmit = function(e) {
                   e.preventDefault();
                   return false;
               };
           }
       };
   }

   // Demographics page
   const demographics = {
       type: jsPsychSurveyHtmlForm,
       html: `
           <div class="banner">
               <img src="MITLogo.jpg" alt="MIT Sloan School of Management">
           </div>
           <div class="instructions">
               <h2><strong>Demographics Information</strong></h2>
              
               <div class="form-group">
                   <label for="age"><strong>How old are you (in years)?</strong></label>
                   <input type="number" id="age" name="age" class="form-input" required min="0" max="120">
               </div>
              
               <div class="form-group" style="margin-top: 30px;">
                   <label><strong>With which gender do you identify most?</strong></label>
                   <div class="radio-group">
                       <div class="radio-option">
                           <input type="radio" id="female" name="gender" value="female" required>
                           <label for="female">Female</label>
                       </div>
                       <div class="radio-option">
                           <input type="radio" id="male" name="gender" value="male">
                           <label for="male">Male</label>
                       </div>
                       <div class="radio-option">
                           <input type="radio" id="nonbinary" name="gender" value="nonbinary">
                           <label for="nonbinary">Non-binary</label>
                       </div>
                       <div class="radio-option">
                           <input type="radio" id="prefer_not_say" name="gender" value="prefer_not_say">
                           <label for="prefer_not_say">Prefer not to say</label>
                       </div>
                       <div class="radio-option">
                           <input type="radio" id="other" name="gender" value="other">
                           <label for="other">Other, please specify:</label>
                           <input type="text" id="gender_other" name="gender_other" class="form-input"
                               style="margin-left: 10px; width: 200px;"
                               oninput="document.getElementById('other').checked = true;">
                       </div>
                   </div>
               </div>
              
               <button type="submit" class="continue-btn">
                   Continue <i class="fas fa-arrow-right"></i>
               </button>
           </div>
       `,
       data: {
           task: 'demographics'
       },
       on_load: function() {
           // Add age validation
           document.querySelector('form').addEventListener('submit', function(e) {
               const age = document.getElementById('age').value;
               if (age < 18 || age > 100) {
                   e.preventDefault();
                   alert('Please enter a valid age between 18 and 100.');
                   return false;
               }
           });
       }
   };

   // NEW Create the timeline
   function createTimeline() {
      const timeline = [
          prolificId,
          welcomeScreen,
          consentInfo1,
          consentInfo2,
          demographics,
          taskInstructions
       ];
    
        // First task: Artwork trials
        const artworkAssignments = createBalancedDesign();
        const artworkTrials = [];
        for (let condition in artworkAssignments) {
            artworkAssignments[condition].forEach(stimulus => {
                artworkTrials.push(createTrial(stimulus, condition));
            });
        }
        timeline.push(...jsPsych.randomization.shuffle(artworkTrials));
    
        // Add transition and second task instructions
        timeline.push(transitionScreen);
        timeline.push(colorTaskInstructions);
    
        // Second task: Color combination trials
        const colorAssignments = createBalancedDesign(colorStimuli);
        const colorTrials = [];
        for (let condition in colorAssignments) {
            colorAssignments[condition].forEach(stimulus => {
                colorTrials.push(createColorTrial(stimulus, condition));
            });
        }
        timeline.push(...jsPsych.randomization.shuffle(colorTrials));

        // Add this new section for the shape task
        timeline.push(shapeTransitionScreen);
        timeline.push(shapeTaskInstructions);
       
        const shapeAssignments = createBalancedDesign(shapeStimuli);
        const shapeTrials = [];
        for (let condition in shapeAssignments) {
            shapeAssignments[condition].forEach(stimulus => {
                shapeTrials.push(createShapeTrial(stimulus, condition));
            });
        }
        timeline.push(...jsPsych.randomization.shuffle(shapeTrials));

        return timeline;
    }

   // Run the experiment
   jsPsych.run(createTimeline());
   </script>
</body>
</html>

